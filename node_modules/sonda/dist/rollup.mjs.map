{"version":3,"file":"rollup.mjs","names":["options: Partial<UserOptions>","inputs: JsonReport[ 'inputs' ]","module: ModuleInfo","bundle: OutputBundle","moduleId: string","isCommonJS: boolean | undefined"],"sources":["../src/entrypoints/rollup.ts"],"sourcesContent":["import { resolve, dirname } from 'path';\nimport {\n\tgenerateReportFromAssets,\n\tcjsRegex,\n\tjsRegexp,\n\tnormalizePath,\n\ttype JsonReport,\n\ttype ModuleFormat,\n\ttype UserOptions\n} from '../index.js';\nimport type { Plugin, ModuleInfo, NormalizedOutputOptions, OutputBundle } from 'rollup';\n\nexport default function SondaRollupPlugin( options: Partial<UserOptions> = {} ): Plugin {\n\tlet inputs: JsonReport[ 'inputs' ] = {};\n\n\treturn {\n\t\tname: 'sonda',\n\n\t\tmoduleParsed( module: ModuleInfo ) {\n\t\t\tif ( options.enabled === false ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tinputs[ normalizePath( module.id ) ] = {\n\t\t\t\tbytes: module.code ? Buffer.byteLength( module.code ) : 0,\n\t\t\t\tformat: getFormat( module.id, module.meta.commonjs?.isCommonJS ),\n\t\t\t\timports: module.importedIds.map( id => normalizePath( id ) ),\n\t\t\t\tbelongsTo: null,\n\t\t\t};\n\t\t},\n\n\t\twriteBundle(\n\t\t\t{ dir, file }: NormalizedOutputOptions,\n\t\t\tbundle: OutputBundle\n\t\t) {\n\t\t\tif ( options.enabled === false ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst outputDir = resolve( process.cwd(), dir ?? dirname( file! ) );\n\t\t\tconst assets = Object.keys( bundle ).map( name => resolve( outputDir, name ) );\n\n\t\t\treturn generateReportFromAssets(\n\t\t\t\tassets,\n\t\t\t\tinputs,\n\t\t\t\toptions\n\t\t\t);\n\t\t}\n\t};\n}\n\nfunction getFormat( moduleId: string, isCommonJS: boolean | undefined ): ModuleFormat {\n\tif ( isCommonJS === true || cjsRegex.test( moduleId ) ) {\n\t\treturn 'cjs';\n\t}\n\n\tif ( isCommonJS === false || jsRegexp.test( moduleId ) ) {\n\t\treturn 'esm';\n\t}\n\n\treturn'unknown';\n}\n"],"mappings":";;;;AAYe,SAAS,kBAAmBA,UAAgC,CAAE,GAAW;CACvF,IAAIC,SAAiC,CAAE;AAEvC,QAAO;EACN,MAAM;EAEN,aAAcC,QAAqB;AAClC,OAAK,QAAQ,YAAY,MACxB;AAGD,UAAQ,cAAe,OAAO,GAAI,IAAK;IACtC,OAAO,OAAO,OAAO,OAAO,WAAY,OAAO,KAAM,GAAG;IACxD,QAAQ,UAAW,OAAO,IAAI,OAAO,KAAK,UAAU,WAAY;IAChE,SAAS,OAAO,YAAY,IAAK,QAAM,cAAe,GAAI,CAAE;IAC5D,WAAW;GACX;EACD;EAED,YACC,EAAE,KAAK,MAA+B,EACtCC,QACC;AACD,OAAK,QAAQ,YAAY,MACxB;GAGD,MAAM,YAAY,QAAS,QAAQ,KAAK,EAAE,OAAO,QAAS,KAAO,CAAE;GACnE,MAAM,SAAS,OAAO,KAAM,OAAQ,CAAC,IAAK,UAAQ,QAAS,WAAW,KAAM,CAAE;AAE9E,UAAO,yBACN,QACA,QACA,QACA;EACD;CACD;AACD;AAED,SAAS,UAAWC,UAAkBC,YAAgD;AACrF,KAAK,eAAe,QAAQ,SAAS,KAAM,SAAU,CACpD,QAAO;AAGR,KAAK,eAAe,SAAS,SAAS,KAAM,SAAU,CACrD,QAAO;AAGR,QAAM;AACN"}