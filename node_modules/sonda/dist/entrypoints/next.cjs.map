{"version":3,"file":"next.cjs","names":["options: Partial<FrameworkUserOptions>","nextConfig: NextConfig","SondaWebpack"],"sources":["../../src/entrypoints/next.ts"],"sourcesContent":["import SondaWebpack from './webpack';\nimport type { NextConfig } from 'next';\nimport type { FrameworkUserOptions } from '../types.js';\n\nexport default function SondaNextPlugin( options: Partial<FrameworkUserOptions> = {} ) {\n  return function Sonda( nextConfig: NextConfig = {} ): NextConfig {\n    if ( options.enabled === false ) {\n      return nextConfig;\n    }\n\n    options.format ??= 'html';\n    options.filename ??= `sonda-report-[env].${ options.format }`;\n\n    // Next.js runs few builds and each must generate a separate report\n    if ( !options.filename.includes( '[env]' ) ) {\n      throw new Error( 'SondaNextPlugin: The \"filename\" option must include the \"[env]\" token.' );\n    }\n\n    const generateForServer = options.server ?? false;\n\n    return Object.assign( {}, nextConfig, {\n      webpack( config, { nextRuntime, isServer } ) {\n        const env = nextRuntime || 'client';\n\n        // Do not generate report for...\n        if (\n          // ... the `edge` build because none of its files have source maps\n          env === 'edge'\n\n          // ... the server build unless explicitly enabled\n          || ( isServer && !generateForServer )\n        ) {\n          return config;\n        }\n\n        // Because this configuration is shared between multiple builds, we need to clone it\n        const sondaOptions = Object.assign( {}, options );\n\n        // Replace the \"[env]\" token with the current build type\n        sondaOptions.filename = sondaOptions.filename!.replace( '[env]', env );\n\n        // Add the Sonda plugin to the Webpack configuration\n        config.plugins.push(\n          new SondaWebpack( sondaOptions )\n        );\n\n        return config;\n      }\n    } satisfies NextConfig );\n  }\n}\n"],"mappings":";;;;;AAIe,SAAS,gBAAiBA,UAAyC,CAAE,GAAG;AACrF,QAAO,SAAS,MAAOC,aAAyB,CAAE,GAAe;AAC/D,MAAK,QAAQ,YAAY,MACvB,QAAO;AAGT,UAAQ,WAAW;AACnB,UAAQ,cAAc,qBAAsB,QAAQ,OAAQ;AAG5D,OAAM,QAAQ,SAAS,SAAU,QAAS,CACxC,OAAM,IAAI,MAAO;EAGnB,MAAM,oBAAoB,QAAQ,UAAU;AAE5C,SAAO,OAAO,OAAQ,CAAE,GAAE,YAAY,EACpC,QAAS,QAAQ,EAAE,aAAa,UAAU,EAAG;GAC3C,MAAM,MAAM,eAAe;AAG3B,OAEE,QAAQ,UAGH,aAAa,kBAElB,QAAO;GAIT,MAAM,eAAe,OAAO,OAAQ,CAAE,GAAE,QAAS;AAGjD,gBAAa,WAAW,aAAa,SAAU,QAAS,SAAS,IAAK;AAGtE,UAAO,QAAQ,KACb,IAAIC,mCAAc,cACnB;AAED,UAAO;EACR,EACF,EAAuB;CACzB;AACF"}