{"version":3,"file":"nuxt.mjs","names":["options: Partial<FrameworkUserOptions>","SondaNuxtPlugin","nuxt: Nuxt"],"sources":["../../src/entrypoints/nuxt.ts"],"sourcesContent":["import Sonda from './rollup';\nimport type { NuxtModule, Nuxt } from '@nuxt/schema';\nimport type { FrameworkUserOptions } from '../types';\n\nexport default function SondaNuxtPlugin( options: Partial<FrameworkUserOptions> = {} ): NuxtModule {\n  return function SondaNuxtPlugin( _, nuxt: Nuxt ): void {\n    if ( options.enabled === false ) {\n      return;\n    }\n\n    options.format ??= 'html';\n    options.filename ??= `sonda-report-[env].${ options.format }`;\n\n    // Nuxt runs few builds and each must generate a separate report\n    if ( !options.filename.includes( '[env]' ) ) {\n      throw new Error( 'SondaNuxtPlugin: The \"filename\" option must include the \"[env]\" token.' );\n    }\n\n    nuxt.hook( 'vite:extendConfig', ( config, { isClient, isServer } ) => {\n      const env = isClient ? 'client' : 'nitro';\n      const generateForServer = options.server ?? false;\n\n      // Do not generate report for the server build unless explicitly enabled\n      if ( isServer && !generateForServer ) {\n        return;\n      }\n\n      // Because this configuration is shared between multiple builds, we need to clone it\n      const sondaOptions = Object.assign( {}, options );\n\n      // Replace the \"[env]\" token with the current build type\n      sondaOptions.filename = sondaOptions.filename!.replace( '[env]', env )\n\n      // Add the Sonda plugin to the Vite configuration\n      config.plugins ??= [];\n      config.plugins.push( Sonda( sondaOptions ) );\n    } )\n  }\n}\n"],"mappings":";;;;AAIe,SAAS,gBAAiBA,UAAyC,CAAE,GAAe;AACjG,QAAO,SAASC,kBAAiB,GAAGC,MAAmB;AACrD,MAAK,QAAQ,YAAY,MACvB;AAGF,UAAQ,WAAW;AACnB,UAAQ,cAAc,qBAAsB,QAAQ,OAAQ;AAG5D,OAAM,QAAQ,SAAS,SAAU,QAAS,CACxC,OAAM,IAAI,MAAO;AAGnB,OAAK,KAAM,qBAAqB,CAAE,QAAQ,EAAE,UAAU,UAAU,KAAM;GACpE,MAAM,MAAM,WAAW,WAAW;GAClC,MAAM,oBAAoB,QAAQ,UAAU;AAG5C,OAAK,aAAa,kBAChB;GAIF,MAAM,eAAe,OAAO,OAAQ,CAAE,GAAE,QAAS;AAGjD,gBAAa,WAAW,aAAa,SAAU,QAAS,SAAS,IAAK;AAGtE,UAAO,YAAY,CAAE;AACrB,UAAO,QAAQ,KAAM,kBAAO,aAAc,CAAE;EAC7C,EAAE;CACJ;AACF"}