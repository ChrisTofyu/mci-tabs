import "../src.mjs";
import { SondaRollupPlugin } from "../rollup.mjs";

//#region src/entrypoints/astro.ts
function SondaAstroPlugin(options = {}) {
	return {
		name: "sonda/astro",
		hooks: { "astro:build:setup"({ vite, target }) {
			if (options.enabled === false) return;
			options.format ??= "html";
			options.filename ??= `sonda-report-[env].${options.format}`;
			if (!options.filename.includes("[env]")) throw new Error("SondaAstroPlugin: The \"filename\" option must include the \"[env]\" token.");
			const generateForServer = options.server ?? false;
			if (target === "server" && !generateForServer) return;
			const sondaOptions = Object.assign({}, options);
			sondaOptions.filename = sondaOptions.filename.replace("[env]", target);
			vite.plugins ??= [];
			vite.plugins.push(SondaRollupPlugin(sondaOptions));
		} }
	};
}

//#endregion
export { SondaAstroPlugin as default };
//# sourceMappingURL=astro.mjs.map